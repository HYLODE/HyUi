<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HYLODE documentation â€“ setup</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../developer/workflow.html" rel="next">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">HYLODE documentation</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../vignettes/vignettes.html">Vignettes</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/HYLODE/HyUI"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">(Untitled)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Developer</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../developer/setup.html" class="sidebar-item-text sidebar-link active">Developing for HyUI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../developer/workflow.html" class="sidebar-item-text sidebar-link">Development workflow</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../developer/documentation.html" class="sidebar-item-text sidebar-link">Writing documentation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../developer/synthetic-data.html" class="sidebar-item-text sidebar-link">Synthetic data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../developer/environment-variables.html" class="sidebar-item-text sidebar-link">Environment variables</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Contributing</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributor_guide/CODE_OF_CONDUCT.html" class="sidebar-item-text sidebar-link">Code of conduct for <code>hyui</code></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributor_guide/CONTRIBUTING.html" class="sidebar-item-text sidebar-link">Contributing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributor_guide/pre_commit_hooks.html" class="sidebar-item-text sidebar-link">Pre-commit hooks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributor_guide/updating_gitignore.html" class="sidebar-item-text sidebar-link">Updating the <code>.gitignore</code> file</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#developing-for-hyui" id="toc-developing-for-hyui" class="nav-link active" data-scroll-target="#developing-for-hyui">Developing for HyUI</a>
  <ul class="collapse">
  <li><a href="#development-environments" id="toc-development-environments" class="nav-link" data-scroll-target="#development-environments">Development environments</a>
  <ul class="collapse">
  <li><a href="#local-machine" id="toc-local-machine" class="nav-link" data-scroll-target="#local-machine">Local machine</a></li>
  <li><a href="#live-machine" id="toc-live-machine" class="nav-link" data-scroll-target="#live-machine">Live machine</a></li>
  </ul></li>
  <li><a href="#setting-up-your-local-development-environment" id="toc-setting-up-your-local-development-environment" class="nav-link" data-scroll-target="#setting-up-your-local-development-environment">Setting up your local development environment</a>
  <ul class="collapse">
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
  <li><a href="#clone-hyui-to-your-local-machine" id="toc-clone-hyui-to-your-local-machine" class="nav-link" data-scroll-target="#clone-hyui-to-your-local-machine">Clone HyUI to your local machine</a></li>
  <li><a href="#set-up-conda-environment" id="toc-set-up-conda-environment" class="nav-link" data-scroll-target="#set-up-conda-environment">Set up conda environment</a></li>
  <li><a href="#direnv-optional" id="toc-direnv-optional" class="nav-link" data-scroll-target="#direnv-optional">Direnv (optional)</a></li>
  <li><a href="#pre-commit" id="toc-pre-commit" class="nav-link" data-scroll-target="#pre-commit">Pre-commit</a></li>
  <li><a href="#running-the-backend-and-frontend" id="toc-running-the-backend-and-frontend" class="nav-link" data-scroll-target="#running-the-backend-and-frontend">Running the backend and frontend</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a>
  <ul class="collapse">
  <li><a href="#development-workflow" id="toc-development-workflow" class="nav-link" data-scroll-target="#development-workflow">Development workflow</a></li>
  <li><a href="#apple-silicon-notes" id="toc-apple-silicon-notes" class="nav-link" data-scroll-target="#apple-silicon-notes">Apple Silicon notes</a></li>
  </ul></li>
  <li><a href="#experimental-pyenv-virtualenv-pip-workflow" id="toc-experimental-pyenv-virtualenv-pip-workflow" class="nav-link" data-scroll-target="#experimental-pyenv-virtualenv-pip-workflow">Experimental PyEnv + Virtualenv + Pip Workflow</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#architecture" id="toc-architecture" class="nav-link" data-scroll-target="#architecture">Architecture</a>
  <ul class="collapse">
  <li><a href="#architecture-ideals" id="toc-architecture-ideals" class="nav-link" data-scroll-target="#architecture-ideals">Architecture Ideals</a></li>
  </ul></li>
  <li><a href="#development" id="toc-development" class="nav-link" data-scroll-target="#development">Development</a>
  <ul class="collapse">
  <li><a href="#install-requirements" id="toc-install-requirements" class="nav-link" data-scroll-target="#install-requirements">Install Requirements</a></li>
  <li><a href="#create-required-virtual-environments" id="toc-create-required-virtual-environments" class="nav-link" data-scroll-target="#create-required-virtual-environments">Create Required Virtual Environments</a></li>
  <li><a href="#activate-virtual-environment" id="toc-activate-virtual-environment" class="nav-link" data-scroll-target="#activate-virtual-environment">Activate Virtual Environment</a></li>
  <li><a href="#install-the-website-app-requirements" id="toc-install-the-website-app-requirements" class="nav-link" data-scroll-target="#install-the-website-app-requirements">Install The Website App Requirements</a></li>
  <li><a href="#install-the-api-requirements" id="toc-install-the-api-requirements" class="nav-link" data-scroll-target="#install-the-api-requirements">Install The API Requirements</a></li>
  <li><a href="#running-the-servers-manually-when-developing" id="toc-running-the-servers-manually-when-developing" class="nav-link" data-scroll-target="#running-the-servers-manually-when-developing">Running The Servers Manually When Developing</a></li>
  </ul></li>
  <li><a href="#deployment" id="toc-deployment" class="nav-link" data-scroll-target="#deployment">Deployment</a>
  <ul class="collapse">
  <li><a href="#build-the-docker-compose-services." id="toc-build-the-docker-compose-services." class="nav-link" data-scroll-target="#build-the-docker-compose-services.">Build the Docker Compose services.</a></li>
  <li><a href="#run-the-docker-compose-services" id="toc-run-the-docker-compose-services" class="nav-link" data-scroll-target="#run-the-docker-compose-services">Run the Docker Compose services</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/hylode/hyui/edit/main/hyui/developer/setup.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/hylode/hyui/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="developing-for-hyui" class="level1">
<h1>Developing for HyUI</h1>
<p>Read this if</p>
<ul>
<li>you are able to code in Python</li>
<li>you already have access to data at UCLH (e.g.&nbsp;EMAP databases or a HYLODE API)</li>
<li>you want to build a data visualisation using Plotly Dash</li>
</ul>
<section id="development-environments" class="level2">
<h2 class="anchored" data-anchor-id="development-environments">Development environments</h2>
<p>There are 2 primary environments needed for development: local machine and a live machine</p>
<section id="local-machine" class="level3">
<h3 class="anchored" data-anchor-id="local-machine">Local machine</h3>
<p>Your own laptop etc. without access to personally identifiable information (PII) etc. You wish to be able to build and run applications with test data.</p>
</section>
<section id="live-machine" class="level3">
<h3 class="anchored" data-anchor-id="live-machine">Live machine</h3>
<p>An NHS machine or similar within sensitive environment with access to PII. You wish to be able to deploy the actual application or generate synthetic data to use in a local environment.</p>
</section>
</section>
<section id="setting-up-your-local-development-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-your-local-development-environment">Setting up your local development environment</h2>
<section id="requirements" class="level3">
<h3 class="anchored" data-anchor-id="requirements">Requirements</h3>
<ul>
<li>Python 3.6.1+ installed</li>
<li>Install <code>direnv</code>, <a href="loading_environment_variables.md#installing-direnv">following these instructions</a></li>
<li>Install <code>conda miniforge</code> (e.g.&nbsp;<code>brew install miniforge</code>)</li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We assume that the majority of the development work will be on your own machine. You will therefore need to set-up your own dev environment. I have been using <a href="https://github.com/conda-forge/miniforge">conda miniforge</a> because this has the best compatibility with the ARM processor on the Mac. I think it should also work on other machines but I have not tested this.</p>
</div>
</div>
</section>
<section id="clone-hyui-to-your-local-machine" class="level3">
<h3 class="anchored" data-anchor-id="clone-hyui-to-your-local-machine">Clone HyUI to your local machine</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/HYLODE/HyUi.git</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> HyUi</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> .env.example .env</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="set-up-conda-environment" class="level3">
<h3 class="anchored" data-anchor-id="set-up-conda-environment">Set up conda environment</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">--file</span><span class="op">=</span>./dev/environment.yml</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate hyui</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then confirm your set-up is OK</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">-m</span> smoke src/tests/smoke</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="direnv-optional" class="level3">
<h3 class="anchored" data-anchor-id="direnv-optional">Direnv (optional)</h3>
<p>Automatically activate your conda environment when you <code>cd</code> into the <code>hyui</code> directory</p>
<p>https://github.com/theskumar/python-dotenv installed python-dotenv</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install python-dotenv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and https://direnv.net</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install direnv</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> .envrc</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">direnv</span> allow .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>add the following to .zshrc</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">eval</span> <span class="st">"</span><span class="va">$(</span><span class="ex">direnv</span> hook zsh<span class="va">)</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pre-commit" class="level3">
<h3 class="anchored" data-anchor-id="pre-commit">Pre-commit</h3>
<p>see docs/contributor_guide/pre_commit_hooks.md need to run this by hand the first time</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pre-commit</span> install</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pre-commit</span> run</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="running-the-backend-and-frontend" class="level3">
<h3 class="anchored" data-anchor-id="running-the-backend-and-frontend">Running the backend and frontend</h3>
<p>Depending on your dev computer, you may not want to run HyUI using Docker (e.g.&nbsp;Apple Silicon laptops experience very high memory use when running docker.)</p>
<section id="docker" class="level4">
<h4 class="anchored" data-anchor-id="docker">Docker</h4>
<p>Run <code>docker-compose up -d</code> to stand up both backend and frontend services using docker.</p>
<p><em>WARNING</em>: you may need <code>docker compose</code> rather than <code>docker-compose</code> depending on your docker version <em>WARNING</em>: docker services depend on a valid <code>.env</code> file (specifically to hold the postgres credentials)</p>
</section>
<section id="backend-services-without-docker" class="level4">
<h4 class="anchored" data-anchor-id="backend-services-without-docker">Backend services without Docker</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ./src</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">uvicorn</span> api.main:app <span class="at">--reload</span> <span class="at">--workers</span> 4 <span class="at">--host</span> 0.0.0.0 <span class="at">--port</span> 8092</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>then navigate to <a href="http://localhost:8092/docs">http://localhost:8092/docs</a> to view the API documentation</p>
</section>
<section id="fronend-service-without-docker" class="level4">
<h4 class="anchored" data-anchor-id="fronend-service-without-docker">Fronend service without Docker</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ./src</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="va">ENV</span><span class="op">=</span>dev <span class="va">DOCKER</span><span class="op">=</span>False <span class="ex">python</span> apps/app.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>then navigate to <a href="http://localhost:8093">http://localhost:8093</a> to view the app</p>
</section>
<section id="using-pycharm-to-debug" class="level4">
<h4 class="anchored" data-anchor-id="using-pycharm-to-debug">Using PyCharm to debug</h4>
</section>
</section>
</section>
</section>
<section id="section" class="level1">
<h1></h1>
<ul>
<li>Ensure the execution envrionment is setup to use the previously created Conda hyui.</li>
<li>Use EnvFile plugin to source the <code>.env</code> file in the root directory.</li>
<li>Ensure the working directory is <code>src</code> not <code>src\apps</code>.</li>
</ul>
<section id="development-workflow" class="level2">
<h2 class="anchored" data-anchor-id="development-workflow">Development workflow</h2>
<p>Once youâ€™re up and running, you can review the development workflow in <a href="dev-workflow.md">Development Workflow</a></p>
</section>
<section id="apple-silicon-notes" class="level2">
<h2 class="anchored" data-anchor-id="apple-silicon-notes">Apple Silicon notes</h2>
<p>See <a href="https://github.com/HYLODE/HySys/tree/dev/hylode#5-development">Hylode HySys</a></p>
</section>
</section>
<section id="experimental-pyenv-virtualenv-pip-workflow" class="level1">
<h1>Experimental PyEnv + Virtualenv + Pip Workflow</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This is an experimental workflow designed to ultimately align the way packages are installed on development machines and in production. It is ultimately intended to replace Conda.</p>
</section>
<section id="architecture" class="level2">
<h2 class="anchored" data-anchor-id="architecture">Architecture</h2>
<p>The <code>code</code> directory contains all the libraries that are used to power the HyUi dashboards.</p>
<ul>
<li><code>code/api</code>: This is a FastAPI app that does all the data wrangling and accessing of external sources such as to databases and web services. For each route there should be an equivalent mock route that allows this app to serve mock data when run in development. For example, if there is a <code>/census/</code> endpoint then there should be a corresponding <code>/mock/census</code> endpoint that only serves mock data.</li>
<li><code>code/web</code>: This is contains the Plotly Dash web server code. It should <em>only</em> communicate with the <code>code/api</code> service. This allows the <code>code/api</code> service to provide mock data seamlessly when developing without needing to spin up other services to help development.</li>
<li><code>code/models</code>: This contains all the Pydantic models that are used to share data between the <code>code/api</code> and <code>code/web</code>.</li>
</ul>
<section id="architecture-ideals" class="level3">
<h3 class="anchored" data-anchor-id="architecture-ideals">Architecture Ideals</h3>
<ul>
<li><code>code/web</code> should only communicate with <code>code/api</code> for data. This allows us to entirely mock data for <code>code/web</code> when developing.</li>
<li>Communication between <code>code/web</code> and <code>code/api</code> should only be done in a defined way using models described in <code>code/models</code>. <code>code/models</code> is the only shared code between <code>code/api</code> and <code>code/web</code>.</li>
<li>Pages in <code>code/web/src/web/pages</code> should be independent of each other so there is minimal/no sharing between two sets of pages. Common code can be put in a separate module or package in <code>code/web</code>.</li>
</ul>
</section>
</section>
<section id="development" class="level2">
<h2 class="anchored" data-anchor-id="development">Development</h2>
<section id="install-requirements" class="level3">
<h3 class="anchored" data-anchor-id="install-requirements">Install Requirements</h3>
<ul>
<li>Install (https://github.com/pyenv/pyenv)[pyenv]</li>
<li>Install (https://github.com/pyenv/pyenv-virtualenv)[pyenv-virtualenv]</li>
</ul>
</section>
<section id="create-required-virtual-environments" class="level3">
<h3 class="anchored" data-anchor-id="create-required-virtual-environments">Create Required Virtual Environments</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pyenv <span class="ex">virtualenv</span> 3.11.0 hyui-web</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pyenv <span class="ex">virtualenv</span> 3.11.0 hyui-api</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="activate-virtual-environment" class="level3">
<h3 class="anchored" data-anchor-id="activate-virtual-environment">Activate Virtual Environment</h3>
<p>In one shell:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pyenv <span class="ex">activate</span> hyui-web</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In another shell:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pyenv <span class="ex">activate</span> hyui-api</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These will be the Python virtual envronments that contains all the dependencies for the Dash web app and the API backend.</p>
</section>
<section id="install-the-website-app-requirements" class="level3">
<h3 class="anchored" data-anchor-id="install-the-website-app-requirements">Install The Website App Requirements</h3>
<p>In the <code>hyui-web</code> terminal in the root directory:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="fu">install</span> <span class="at">-e</span> <span class="st">"code/utils[test]"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="fu">install</span> <span class="at">-e</span> <span class="st">"code/models[test]"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="fu">install</span> <span class="at">-e</span> <span class="st">"code/web[test]"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="install-the-api-requirements" class="level3">
<h3 class="anchored" data-anchor-id="install-the-api-requirements">Install The API Requirements</h3>
<p>In the <code>hyui-api</code> terminal in the root directory:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="fu">install</span> <span class="at">-e</span> <span class="st">"code/utils[test]"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="fu">install</span> <span class="at">-e</span> <span class="st">"code/models[test]"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="fu">install</span> <span class="at">-e</span> <span class="st">"code/api[test]"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="running-the-servers-manually-when-developing" class="level3">
<h3 class="anchored" data-anchor-id="running-the-servers-manually-when-developing">Running The Servers Manually When Developing</h3>
<p>The web server when in the <code>hyui-web</code> shell:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> env <span class="va">$(</span><span class="fu">grep</span> <span class="at">-v</span> <span class="st">'^#'</span> .env <span class="kw">|</span> <span class="fu">xargs</span><span class="va">)</span> python <span class="at">-m</span> web.main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The API server when in the <code>hyui-api</code> shell:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> env <span class="va">$(</span><span class="fu">grep</span> <span class="at">-v</span> <span class="st">'^#'</span> .env <span class="kw">|</span> <span class="fu">xargs</span><span class="va">)</span> uvicorn api.main:app <span class="at">--reload</span> <span class="at">--port</span> 8092</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ensure you replace <code>.env</code> with the correct path to your development <code>.env</code> file. The command <code>env $(grep -v '^#' .env | xargs)</code> loads the contents of the <code>.env</code> into the environment just for the current execution. The <code>grep -v '^#'</code> part excludes lines beginning with a <code>#</code> in the env file.</p>
</section>
</section>
<section id="deployment" class="level2">
<h2 class="anchored" data-anchor-id="deployment">Deployment</h2>
<p>First create a <code>code/.env</code> file and ensure it is correct.</p>
<section id="build-the-docker-compose-services." class="level3">
<h3 class="anchored" data-anchor-id="build-the-docker-compose-services.">Build the Docker Compose services.</h3>
<p>In the <code>code</code> directory:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> docker <span class="ex">compose</span> build</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="run-the-docker-compose-services" class="level3">
<h3 class="anchored" data-anchor-id="run-the-docker-compose-services">Run the Docker Compose services</h3>
<p>In the <code>code</code> directory:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> docker <span class="ex">compose</span> up</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="../developer/workflow.html" class="pagination-link">
        <span class="nav-page-text">Development workflow</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Hyperlocal Bed Demand Forecasts A project deployed at UCLH supported by NIHR and NHS-X. (2022)</div>
  </div>
</footer>



</body></html>